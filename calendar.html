<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Community Events Calendar</title>

  <!-- FullCalendar CSS -->
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css' rel='stylesheet' />
  <!-- FullCalendar JS -->
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.js'></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f8f8f8; }
    h1 { text-align:center; }
    #calendar { max-width: 1000px; margin: 40px auto; padding: 0 10px; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .fc-event { cursor: pointer; font-size: 0.9rem; }
    .fc-event.past-event { background-color: #cccccc !important; border-color: #999999 !important; color: #555555 !important; }
    #calendar-legend { max-width:1000px; margin:20px auto; text-align:center; }
    .legend-item { display: inline-block; margin: 0 10px; font-size: 0.9rem; }
    .legend-color { width: 15px; height: 15px; display: inline-block; margin-right: 5px; vertical-align: middle; }
    @media (max-width: 600px) { #calendar { margin: 20px 5px; } .fc-event { font-size: 0.75rem; } .legend-item { margin:0 5px; font-size:0.75rem; } }
  </style>
</head>
<body>

<h1>Community Events Calendar</h1>

<div id='calendar'></div>
<div id="calendar-legend"></div>

<script>
  const today = new Date().toISOString().split('T')[0];

  // Events from YAML _data folder (Jekyll)
  const events = [
    {% for file in site.data.events %}
      {% assign event = file[1] %}
      {
        title: "{{ event.title | escape }}",
        start: "{{ event.date }}",
        url: "{{ event.signup_url }}",
        description: "{{ event.description | escape }}",
        location: "{{ event.location | escape }}",
        organiser: "{{ event.organiser | escape }}",
        color: "{% if event.organiser == 'Software Sustainability Institute' %}#1f77b4{% else %}#ff7f0e{% endif %}"
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];

  // Mark past events
  events.forEach(e => { if(e.start < today) e.classNames = ['past-event']; });

  // Generate legend
  const organiserColors = {};
  events.forEach(e => { organiserColors[e.organiser] = e.color; });
  const legendContainer = document.getElementById('calendar-legend');
  Object.keys(organiserColors).forEach(org => {
    const item = document.createElement('span');
    item.className = 'legend-item';
    item.innerHTML = `<span class="legend-color" style="background-color:${organiserColors[org]}"></span>${org}`;
    legendContainer.appendChild(item);
  });

  // Initialize FullCalendar
  document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: { left:'prev,next today', center:'title', right:'dayGridMonth,listMonth' },
      events: events,
      eventClick: function(info) { info.jsEvent.preventDefault(); window.open(info.event.url, '_blank'); },
      eventDidMount: function(info) {
        info.el.setAttribute('title',
          info.event.extendedProps.description +
          "\nLocation: " + info.event.extendedProps.location +
          "\nOrganiser: " + info.event.extendedProps.organiser
        );
      },
      height: 'auto',
      dayMaxEvents: true
    });
    calendar.render();
  });
</script>

</body>
</html>
